# standard settings + BPE
slkces.cfg016: !LoadSerialized
  # This will load the contents of the above experiments that were saved to the
  # YAML file specified after filename:
  # This will carry out the exact same thing, except that {EXP} is resolved to
  # a different value (making sure we don't overwrite the previous model),
  # and except for the things explicitly overwritten in the overwrite: section.
  # It's possible to change any settings as long as these don't change the number
  # or nature of DyNet parameters allocated for the component.
  filename: results/02-all/all.cfg000.mod
  path: ''
  overwrite: # list of [path, value] pairs. Value can be scalar or an arbitrary object
  - path: exp_global.log_file
    val: 'results/03-adapt/{EXP}.log'
  - path: exp_global.model_file
    val: 'results/03-adapt/{EXP}.mod'
  - path: train
    val: !AlternatingBatchMultiTaskTrainingRegimen
      task_weights: [0.2, 0.8]
      dev_zero: True
      trainer: !AdamTrainer
        alpha: 0.001
      tasks:
      - !SimpleTrainingTask # first task is the main task: it will control early stopping, learning rate schedule, model checkpoints, ..
        name: "{EXP}.first"
        batcher: !WordSrcBatcher
          avg_batch_size: 64
        lr_decay: 0.5
        patience: 2
        restart_trainer: True
        run_for_epochs: 20
        model: !Ref { path: model }
        src_file: 'data/slk_eng/ted-train.orig.spm8000.slk'
        trg_file: 'data/slk_eng/ted-train.mtok.spm8000.eng'
        dev_tasks:
          - !AccuracyEvalTask
            eval_metrics: bleu
            src_file: 'data/slk_eng/ted-dev.orig.spm8000.slk'
            ref_file: 'data/slk_eng/ted-dev.mtok.eng'
            hyp_file: 'results/03-adapt/{EXP}.dev_hyp'
          - !LossEvalTask
            src_file: 'data/slk_eng/ted-dev.orig.spm8000.slk'
            ref_file: 'data/slk_eng/ted-dev.mtok.spm8000.eng'
      - !SimpleTrainingTask
        name: "{EXP}.second"
        batcher: !WordSrcBatcher
          avg_batch_size: 64
        model: !Ref { path: model }
        src_file: 'data/ces_eng/ted-train.orig.spm8000.ces'
        trg_file: 'data/ces_eng/ted-train.mtok.spm8000.eng'
        dev_every: 100000000
        dev_tasks: null
  - path: evaluate
    val:
    - !AccuracyEvalTask
      eval_metrics: bleu
      src_file: 'data/slk_eng/ted-dev.orig.spm8000.slk'
      ref_file: 'data/slk_eng/ted-dev.mtok.eng'
      hyp_file: 'results/03-adapt/{EXP}.dev_hyp'
    - !AccuracyEvalTask
      eval_metrics: bleu
      src_file: 'data/slk_eng/ted-test.orig.spm8000.slk'
      ref_file: 'data/slk_eng/ted-test.mtok.eng'
      hyp_file: 'results/03-adapt/{EXP}.tst_hyp'
